<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quick Notes</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{margin:0;display:flex;height:100vh}
    .sidebar{width:320px;border-right:1px solid #e6e6e6;padding:12px;box-sizing:border-box}
    .main{flex:1;padding:12px;box-sizing:border-box}
    input,textarea,button{font:inherit}
    .note-item{padding:8px;border-radius:6px;cursor:pointer;margin-bottom:6px;background:#fafafa;border:1px solid #eee}
    .note-item.active{background:#e8f0ff}
    .controls{display:flex;gap:8px;margin-top:8px}
    .list{height:calc(100vh - 170px);overflow:auto;padding-right:6px}
    textarea{width:100%;height:60vh;resize:vertical;padding:8px;border-radius:6px;border:1px solid #ddd}
    .small{font-size:13px;color:#666}
    .topbar{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="topbar">
      <input id="filter" placeholder="Search..." style="flex:1;padding:8px;border-radius:6px;border:1px solid #ddd" />
      <button id="newBtn">New</button>
    </div>
    <div style="margin-top:10px">
      <button id="exportBtn">Export .json</button>
      <button id="importBtn">Import</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>
    <div class="list" id="notesList"></div>
    <div class="small" style="margin-top:8px">Notes stored locally (browser). Works offline.</div>
  </div>
  <div class="main">
    <input id="title" placeholder="Title" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-bottom:8px" />
    <textarea id="content" placeholder="Write your note here..."></textarea>
    <div class="controls">
      <button id="saveBtn">Save</button>
      <button id="copyBtn">Copy</button>
      <button id="deleteBtn">Delete</button>
      <button id="clearAllBtn">Clear All</button>
      <div style="flex:1"></div>
      <div class="small" id="status"></div>
    </div>
  </div>

  <script>
    const KEY = 'quick_notes_v1';
    let notes = JSON.parse(localStorage.getItem(KEY) || '{}');
    let currentId = null;

    const els = {
      notesList: document.getElementById('notesList'),
      title: document.getElementById('title'),
      content: document.getElementById('content'),
      saveBtn: document.getElementById('saveBtn'),
      copyBtn: document.getElementById('copyBtn'),
      deleteBtn: document.getElementById('deleteBtn'),
      newBtn: document.getElementById('newBtn'),
      filter: document.getElementById('filter'),
      status: document.getElementById('status'),
      exportBtn: document.getElementById('exportBtn'),
      importBtn: document.getElementById('importBtn'),
      importFile: document.getElementById('importFile'),
      clearAllBtn: document.getElementById('clearAllBtn')
    };

    function saveNotesToStorage(){
      localStorage.setItem(KEY, JSON.stringify(notes));
      flash('Saved');
      renderList();
    }

    function flash(msg){
      els.status.textContent = msg;
      clearTimeout(flash._t);
      flash._t = setTimeout(()=> els.status.textContent = '', 1200);
    }

    function uid(){return Date.now().toString(36) + Math.random().toString(36).slice(2,7)}

    function renderList(filter=''){
      els.notesList.innerHTML = '';
      const entries = Object.entries(notes).sort((a,b)=> b[1].updated - a[1].updated);
      for(const [id,note] of entries){
        if(filter && !(note.title+note.content).toLowerCase().includes(filter.toLowerCase())) continue;
        const div = document.createElement('div');
        div.className = 'note-item' + (id===currentId? ' active':'');
        div.innerHTML = `<strong>${escapeHtml(note.title||'(no title)')}</strong><div class="small">${new Date(note.updated).toLocaleString()}</div>`;
        div.onclick = ()=>{loadNote(id)};
        els.notesList.appendChild(div);
      }
    }

    function loadNote(id){
      currentId = id;
      const n = notes[id];
      els.title.value = n.title;
      els.content.value = n.content;
      renderList(els.filter.value);
    }

    function newNote(){
      currentId = null;
      els.title.value = '';
      els.content.value = '';
      renderList(els.filter.value);
      els.title.focus();
    }

    els.saveBtn.onclick = ()=>{
      const t = els.title.value.trim();
      const c = els.content.value;
      const now = Date.now();
      if(!currentId){
        currentId = uid();
      }
      notes[currentId] = {title:t, content:c, updated:now};
      saveNotesToStorage();
    };

    els.copyBtn.onclick = async ()=>{
      const text = (els.title.value? els.title.value + '\n' : '') + els.content.value;
      try{await navigator.clipboard.writeText(text); flash('Copied') }catch(e){flash('Copy failed')}
    };

    els.deleteBtn.onclick = ()=>{
      if(!currentId) return newNote();
      delete notes[currentId];
      currentId = null;
      saveNotesToStorage();
      newNote();
    };

    els.newBtn.onclick = newNote;

    els.filter.oninput = ()=> renderList(els.filter.value);

    // export
    els.exportBtn.onclick = ()=>{
      const blob = new Blob([JSON.stringify(notes, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'quick-notes.json'; a.click();
      URL.revokeObjectURL(url);
    };

    els.importBtn.onclick = ()=> els.importFile.click();
    els.importFile.onchange = ()=>{
      const f = els.importFile.files[0];
      if(!f) return;
      const r = new FileReader();
      r.onload = e=>{
        try{ const obj = JSON.parse(e.target.result); notes = {...notes, ...obj}; saveNotesToStorage(); flash('Imported') }catch(e){flash('Invalid JSON')}
      };
      r.readAsText(f);
    };

    els.clearAllBtn.onclick = ()=>{
      if(!confirm('Clear all notes?')) return; notes = {}; currentId = null; saveNotesToStorage(); newNote();
    };

    // helpers
    function escapeHtml(s){ return String(s).replace(/[&<>\"]/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','\\':'&#92;','"':'&quot;'}[c])) }

    // keyboard shortcuts
    document.addEventListener('keydown', e=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); els.saveBtn.click(); }
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='b'){ e.preventDefault(); els.copyBtn.click(); }
    });

    // init
    renderList();
    if(Object.keys(notes).length) loadNote(Object.keys(notes).sort((a,b)=> notes[b].updated - notes[a].updated)[0]);
  </script>
</body>
</html>
